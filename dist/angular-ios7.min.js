/*! angular-ios7 19-01-2014 */
angular.module("mobileClone",["ngRoute","ngTouch","ngAnimate"]),angular.module("mobileClone").directive("mcList",function(a,b){return{restrict:"E",replace:!0,scope:{items:"=",changeTo:"@",param:"@"},template:'<ul class="arrowed"></ul>',controller:function(b){b.clicked=function(c){console.log("clicked item",c),a.next(b.changeTo,c)}},link:function(a,c,d){console.log("rendering list in element:",c,"with attributes:",d),console.log("looping through the list items:",a.items),angular.forEach(a.items,function(b){var d=a.changeTo?" ng-click=\"clicked('"+(a.param&&b[a.param])+"')\"":"",e="<li"+d+'><div class="innerLi"><div class="big">'+b.title+'</div><div class="light">'+b.desc+"</div></div></li>";c.append(e)}),b(c)(a)}}}),angular.module("mobileClone").directive("mcPage",function(a,b){return{restrict:"E",replace:!0,transclude:!0,scope:{id:"@",title:"@"},template:"<section ng-transclude></section>",controller:function(b){var c=b.buttons=[];this.addButton=function(a){c.push(a)},a.add(b)},link:function(a,c,d){console.log("rendering page in element:",c,"with attributes:",d),c.find("header").append("<h1>"+a.title+"</h1>"),b.resize(c.find("h1")[0])}}}).directive("mcNav",function(a){return{restrict:"E",replace:!0,transclude:!0,require:"^mcPage",scope:{position:"@",changeTo:"@",back:"=",action:"="},template:'<button ng-click="clicked()"><div class="label" ng-transclude></div></button>',controller:function(b){b.clicked=function(){console.log("clicked:",b),b.changeTo?a.next(b.changeTo):b.back===!0?a.back():console.log("no action associated with the page")}},link:function(a,b,c,d){console.log("rendering button in element:",b,"with attributes:",c);var e=[a.position+"-nav"||"left-nav"];a.back===!0&&e.push("arrow"),a.action===!0&&e.push("bold"),b.addClass(e.join(" ")),d.addButton(a)}}}).directive("mcContent",function(){return{restrict:"E",replace:!0,transclude:!0,require:"^mcPage",scope:{},template:'<div class="scrollWrap"><div class="scroll"><div class="content" ng-transclude></div></div></div>',link:function(a,b,c){console.log("rendering content in element:",b,"with attributes:",c),b.parent().find("header").after('<div class="scrollMask"></div>')}}}),angular.module("mobileClone").directive("mcView",function(a,b){return{restrict:"E",scope:!0,replace:!0,template:'<ng-view id="ng-view" class="slide-animation"></ng-view>',controller:function(c,d){console.log("rendering mobile clone view:",d,"with scope:",c),b.$on("$routeChangeStart",function(d,e,f){function g(a){var b=a&&a.$$route&&a.$$route.originalPath;return b?b.split("/")[1]:null}return console.log("changed the route from:",f,"to",e),e&&e.$$route&&e.$$route.originalPath?(c.current=g(e),c.previous=g(f),e.pathParams&&(console.log("adding the route params to scope:",e.pathParams),angular.extend(c,e.pathParams)),b.$emit("pageChangeStart",c),console.log("found page(s) in route:",{current:c.current,previous:c.previous}),a.route(c.previous,c.current,!1),console.log("updated pages info:",a.info()),b.$emit("pageChangeSuccess",a.info()),void 0):(console.warn("could not process route because it is invalid: "+JSON.stringify(e)),!1)})},link:function(){}}}),angular.module("mobileClone").factory("$pages",function(a,b,c,d){var e={_current:null,_previous:null,_history:[],_pages:[],_back:null,_params:null,add:function(a){console.log("adding page to collection:",a),e._pages.push(a)},route:function(a,b,c){if(a?(console.log("setting previous page from id:",a),e._previous=e.find(a)):console.log("no previous route, this is the landing page"),b&&(console.log("setting current page from id:",b),e._current=e.find(b)),!b||!e._current)throw new Error("could not set the current page, the route is invalid");console.log("adding current page to history..."),e._history.push(e._current),e.previous()&&e.current()!=e.previous()&&(console.log("the route points to a different page, transitioning..."),e._back=c)},find:function(a){console.log("looking for page",a,"in pages:",e._pages);var b=null;return angular.forEach(e._pages,function(c){a===c.id&&(b=c)}),b},current:function(){return e._current},previous:function(){return e._previous},info:function(){return{current:e.current(),previous:e.previous(),historySize:e._history.length}},next:function(a,b){console.log("going to page:",a),c.search({}),c.path("/"+a+(b?"/"+b:""))},back:function(){if(console.log("going back to previous page:",e.previous()),!e.previous())throw new Error("there is no previous page to go back to");d.history.back()}};return e});var $=function(a){return document.getElementById(a)},slideOpts={sl:["slin","slout"],sr:["srin","srout"],popin:["popin","noanim"],popout:["noanim","popout"]},clearNode=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},Slide=function(a,b,c,d){var e=$(b),f=$(c),g=function(){f.classList.add("hidden"),e.classList.remove(slideOpts[a][0]),f.classList.remove(slideOpts[a][1]),f.removeEventListener("webkitAnimationEnd",g,!1),f.removeEventListener("animationend",g)};f.addEventListener("webkitAnimationEnd",g,!1),f.addEventListener("animationend",g),d&&"function"==typeof d&&d(),e.classList.remove("hidden"),e.classList.add(slideOpts[a][0]),f.classList.add(slideOpts[a][1])},ScrollTop=function(){var a=this.parentNode.parentNode.childNodes[5],b=a.scrollTop,c=setInterval(function(){a.scrollTop=b,b-=24,-24>=b&&clearInterval(c)},8)},TextboxResize=function(a){a.removeEventListener("click",ScrollTop,!1),a.addEventListener("click",ScrollTop,!1);var b=a.parentNode.querySelectorAll("button.left")[0],c=a.parentNode.querySelectorAll("button.right")[0];"undefined"==typeof b&&(b={offsetWidth:0,className:""}),"undefined"==typeof c&&(c={offsetWidth:0,className:""});var d=Math.max(b.offsetWidth,c.offsetWidth);a.style.marginLeft=d+"px",a.style.marginRight=d+"px";var e=a.offsetWidth<a.scrollWidth?!0:!1;e&&(b.offsetWidth<c.offsetWidth?(a.style.marginLeft=b.offsetWidth+"px",a.style.textAlign="right"):(a.style.marginRight=c.offsetWidth+"px",a.style.textAlign="left"),e=a.offsetWidth<a.scrollWidth?!0:!1,e&&(new RegExp("arrow").test(b.className)&&(clearNode(b.childNodes[1]),a.style.marginLeft="26px"),new RegExp("arrow").test(c.className)&&(clearNode(c.childNodes[1]),a.style.marginRight="26px")))};angular.module("mobileClone").animation(".slide-animation",function(a,b,c){return{enter:function(c,d){console.log("animating enter element:",c),console.log("transitioning from:",a.previous(),"to",a.current()),console.log("the back page:",a._back);var e=a._back?"sr":"sl";b.slide(e,a.previous().id,a.current().id).then(function(){console.log("slide transition complete with animation:",e),d()})},leave:function(b,d){console.log("giving one second for the transition animation to complete"),c(function(){console.log("removing",a.previous(),"from ng-view..."),d()},1e3)}}}).factory("$transitions",function(a){return{slide:function(b,c,d){console.log("sliding:",b,c,d);var e=a.defer();try{Slide(b,d,c,function(){e.resolve(!0)})}catch(f){e.reject(f)}return e.promise},resize:function(a){console.log("resizing header:",a),TextboxResize(a)}}}),angular.module("mobileClone").run(["$templateCache",function(a){"use strict";a.put("demo/partials/view-details.html",'<mc-page id="view-details" title="Details Page">\n    <header>\n        <mc-nav position="left" back="true">Back</mc-nav>\n    </header>\n    <mc-content>\n        <div class="strap">\n            <div class="jumbotron">\n\n                <div class="container">\n                    <h1>{{title}}</h1>\n\n                    <p>{{description}}</p>\n\n                    <p><a class="btn btn-primary btn-lg" role="button">Learn more</a></p>\n                </div>\n            </div>\n            <div class="container">\n                <div class="row">\n                    <div class="col-sm-12 col-lg-6">\n                        <div class="btn-group btn-group-justified">\n                            <a class="btn btn-default" role="button">Left</a>\n                            <a class="btn btn-default" role="button">Middle</a>\n                            <a class="btn btn-default" role="button">Right</a>\n                        </div>\n                        <br>\n\n                        <div class="input-group">\n                            <span class="input-group-addon">@</span>\n                            <input type="text" class="form-control" placeholder="Username">\n                        </div>\n                        <br>\n                        <button type="button" class="btn btn-primary btn-lg btn-block">Block level button\n                        </button>\n                        <button type="button" class="btn btn-default btn-lg btn-block">Block level button\n                        </button>\n                        <br>\n                        <ul class="list-group">\n                            <li class="list-group-item">\n                                <span class="badge">14</span>\n                                Cras justo odio\n                            </li>\n                            <li class="list-group-item">\n                                <span class="badge">2</span>\n                                Dapibus ac facilisis in\n                            </li>\n                            <li class="list-group-item">\n                                <span class="badge">1</span>\n                                Morbi leo risus\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </mc-content>\n</mc-page>\n'),a.put("demo/partials/view-done.html",'<mc-page id="view-done" title="Done Page">\n    <header>\n        <mc-nav position="left" back="true">Back</mc-nav>\n        <mc-nav position="right" change-to="view-home" action="true">Done</mc-nav>\n    </header>\n    <mc-content>\n        <h1>Done!</h1>\n    </mc-content>\n</mc-page>\n'),a.put("demo/partials/view-home.html",'<mc-page id="view-home" title="Test Page">\n    <header>\n        <mc-nav position="left" back="true">Menu</mc-nav>\n        <mc-nav position="right" change-to="view-done" action="true">Info</mc-nav>\n    </header>\n    <mc-content>\n        <mc-list items="items" change-to="view-details" param="id"></mc-list>\n    </mc-content>\n</mc-page>\n')}]);